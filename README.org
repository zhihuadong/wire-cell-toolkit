#+TITLE: Wire Cell Toolkit 

This package provides the primary "build aggregation" source package
for the various Wire Cell Toolkit (WCT) packages.  

See http://wirecell.github.io/ for WCT manual and news "blog".

The home page for the general Wire Cell effort is http://lar.bnl.gov/wire-cell/.

[[https://travis-ci.org/WireCell/wire-cell-toolkit][https://api.travis-ci.org/WireCell/wire-cell-toolkit.svg?branch=master]]


* Installation

** Get the source

See below for how to use ~git~ to get the full source history and any
particular release.  Select releases are archived and available in ~tar~
file form at:

https://lar.bnl.gov/software/releases/

** External software dependencies

The core of WCT depends on:

- Boost
- JsonCPP
- Jsonnet
- Eigen
- FFTW

Optional dependencies include

- ROOT
- TBB

You may provide the necessary external software dependencies as you
wish.  Some options include:

- [[https://github.com/WireCell/wire-cell-spack][Spack-based install]] automatically builds all (non-OS) externals and WCT itself
- Some WCT releases are built at FNAL as a UPS product named =wirecell=.
- Exploit the above with a [[https://github.com/WireCell/wire-cell-singularity][Singularity container and CVMFS]] (currently recommended)

** Developer Source

Developers check out =master= branch via SSH.

#+BEGIN_EXAMPLE
  $ git clone git@github.com:WireCell/wire-cell-toolkit.git wct
#+END_EXAMPLE

** User Source

Users typically should build a release branch, either the tip or a
tagged release on that branch.  Tagged releases are shown on the [[https://github.com/WireCell/wire-cell-toolkit/releases][this
GitHub release page]].  

Users may also anonymously clone in the usual way:

#+BEGIN_EXAMPLE
  $ git clone https://github.com/WireCell/wire-cell-toolkit.git
#+END_EXAMPLE

** Configuring the source

On well-behaved systems you can do:

#+BEGIN_EXAMPLE
  $ ./wcb configure --prefix=/path/to/install
#+END_EXAMPLE

Software dependencies which can not automatically be located can be
manually specified.  For a list of options run:

#+BEGIN_EXAMPLE
  $ ./wcb --help
#+END_EXAMPLE

Here is an example where some packages are found automatically and
some need help and others are explicitly turned off:

#+begin_example
  $ ./wcb configure \
          --prefix=$HOME/dev/wct/install \
          --with-jsonnet=$HOME/opt/jsonnet \
          --with-eigen-include=/usr/include/eigen3 \
          --with-root=no
  ...
  Removing submodule "dfp" due to lack of external
  Removing package "tbb" due to lack of external dependency
  Removing package "root" due to lack of external dependency
  Removing package "cuda" due to lack of external dependency
  Configured for submodules: apps, cfg, gen, iface, img, pgraph, ress, sigproc, sio, util
  'configure' finished successfully (5.683s)
#+end_example

** Building

It is suggested to first build the code before running tests.

#+BEGIN_EXAMPLE
  $ ./wcb -p --notests
#+END_EXAMPLE

** Installing

To install the code while still avoiding the tests do:

#+BEGIN_EXAMPLE
  $ ./wcb -p --notests install
#+END_EXAMPLE

** Testing

Running the tests can take a while but should be run on new
installations and after any significant development.  The developers
try not to leave broken tests so any failure should be treated as
important.  However, some tests require proper environment to run
successfully.  In particular, tests need to find Wire-Cell
configuration and the shared libraries of the external software
dependencies need to be located.  Below shows an example:

#+BEGIN_EXAMPLE
  $ export WIRECELL_PATH=$HOME/dev/wct/wire-cell-data:$HOME/dev/wct/wire-cell-toolkit/cfg
  $ export LD_LIBRARY_PATH=$HOME/dev/wct/install/lib:$HOME/opt/jsonnet/lib
  $ ./wcb -p --alltests
  ...
  execution summary 
    tests that pass 83/83
      ... 
    tests that fail 0/83 
  'build' finished successfully (15.192s)
#+END_EXAMPLE

* Release management

To make releases, the above details are baked into two test scripts [[https://github.com/WireCell/waf-tools/blob/master/make-release.sh][make-release.sh]] and [[https://github.com/WireCell/waf-tools/blob/master/test-release.sh][test-release.sh]].  See comments at the top of each for how to run them.  These scripts can be used by others but are meant for developers to make official releases.  

* Meta

A new =wcb= build script is made from [[https://github.com/waf-project/waf][waf source]] via:

#+BEGIN_EXAMPLE
  $ ./waf-light --tools=compat15,doxygen,boost,bjam
  $ cp waf /path/to/wire-cell/source/wcb
#+END_EXAMPLE



